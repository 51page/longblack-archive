<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LongBlack Archive - V13 Final</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Observer.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@700;800&family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #000;
            --accent: #FF4E00;
            --tile-w: 110px; --tile-h: 155px; --gap: 12px;
            --nav-h: 90px;
        }
        @media (min-width: 768px) {
            --tile-w: 130px; --tile-h: 185px; --gap: 15px;
        }

        body, html {
            margin: 0; padding: 0; width: 100%; height: 100%;
            background-color: var(--bg); color: #fff;
            font-family: 'Montserrat', sans-serif; overflow: hidden; 
            touch-action: none; /* 시스템 스크롤 차단하고 스크립트로 제어 */
        }

        #category-nav {
            position: fixed; top: 0; left: 0; width: 100%; height: var(--nav-h);
            display: flex; align-items: center; justify-content: flex-start;
            gap: 20px; padding: 0 30px; z-index: 100;
            background: linear-gradient(to bottom, #000 60%, transparent);
            overflow-x: auto; scrollbar-width: none;
        }
        #category-nav::-webkit-scrollbar { display: none; }
        @media (min-width: 1024px) { #category-nav { justify-content: center; } }

        .nav-item {
            font-size: 0.8rem; font-weight: 900; color: #555;
            cursor: pointer; text-transform: uppercase; letter-spacing: 2px;
            transition: all 0.4s ease; white-space: nowrap; flex-shrink: 0;
        }
        .nav-item.active { color: var(--accent); transform: scale(1.1); }

        #grid-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center;
            gap: var(--gap); z-index: 10;
        }
        .grid-row { display: flex; gap: var(--gap); width: max-content; }

        .tile {
            width: var(--tile-w); height: var(--tile-h);
            background: #111; border-radius: 4px; overflow: hidden;
            cursor: pointer; flex-shrink: 0; filter: brightness(0.4) grayscale(1);
            transition: filter 0.5s ease; -webkit-tap-highlight-color: transparent;
        }
        .tile img { width: 100%; height: 100%; object-fit: cover; pointer-events: none; }

        body.is-filtered .tile.dimmed { opacity: 0; pointer-events: none; transform: scale(0.3); }
        body.is-filtered .tile.matched { filter: brightness(1.1) grayscale(0); z-index: 50; }

        #focus-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.97); backdrop-filter: blur(25px);
            display: flex; align-items: center; justify-content: center;
            z-index: 9999; opacity: 0; pointer-events: none; transition: opacity 0.5s ease;
        }
        #focus-overlay.active { opacity: 1; pointer-events: auto; }

        .focus-content {
            width: 88%; max-width: 440px; text-align: center;
            display: flex; flex-direction: column; align-items: center;
        }
        .focus-img { width: 100%; max-height: 32vh; border-radius: 8px; object-fit: contain; margin-bottom: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.8); }
        
        .focus-quote { font-family: 'Nanum Myeongjo', serif; font-size: 1.15rem; font-weight: 800; line-height: 1.6; margin-bottom: 12px; word-break: keep-all; }
        .focus-title { font-size: 0.8rem; font-weight: 600; opacity: 0.8; margin-bottom: 8px; color: #ccc; }
        
        .focus-meta { display: flex; align-items: center; gap: 15px; font-size: 0.7rem; color: #888; margin-bottom: 25px; }
        .rating { color: #FFB800; font-weight: 700; }
        .author::before { content: "|"; margin: 0 12px; opacity: 0.3; }

        .view-btn { 
            display: inline-block; padding: 14px 40px; background: var(--accent); 
            color: #fff; text-decoration: none; font-size: 0.75rem; font-weight: 800; 
            border-radius: 50px; letter-spacing: 2px; transition: transform 0.2s;
        }
        .close-hint { margin-top: 30px; font-size: 0.6rem; opacity: 0.3; letter-spacing: 2px; cursor: pointer; }
    </style>
</head>
<body style="opacity: 0; transition: opacity 0.8s;">

    <nav id="category-nav">
        <span class="nav-item active" data-cat="all">All</span>
        <span class="nav-item" data-cat="브랜딩">Branding</span>
        <span class="nav-item" data-cat="사업기획">Business</span>
        <span class="nav-item" data-cat="디자인">Design</span>
        <span class="nav-item" data-cat="자기계발">Growth</span>
        <span class="nav-item" data-cat="테크">Tech</span>
        <span class="nav-item" data-cat="책 리뷰">Book</span>
        <span class="nav-item" data-cat="예술">Art</span>
    </nav>

    <div id="grid-container"></div>

    <div id="focus-overlay">
        <div class="focus-content">
            <img id="focus-img" src="" class="focus-img">
            <p id="focus-quote" class="focus-quote"></p>
            <h3 id="focus-title" class="focus-title"></h3>
            <div class="focus-meta">
                <span class="rating">★ 4.8</span>
                <span class="author">저자 홍길동</span>
            </div>
            <a id="focus-link" href="https://www.longblack.co/" target="_blank" class="view-btn">READ NOTE</a>
            <p class="close-hint">CLOSE</p>
        </div>
    </div>

    <script>
        const images = [
            "https://longblack-contens.s3.ap-northeast-2.amazonaws.com/image/20260114/1768384619eac446d2cac1af75e09af270aaacb279.png",
            "https://longblack-contens.s3.ap-northeast-2.amazonaws.com/image/20260114/1768384603edcd73ebd53934bf6a377eedc43790ec.png",
            "https://longblack-contens.s3.ap-northeast-2.amazonaws.com/image/20260114/17683845947c75c9555c9bbfe7c994abc37a6785d5.png",
            "https://longblack-contens.s3.ap-northeast-2.amazonaws.com/image/20260112/1768210148519c8f742204d28d70bf4ace87622432.png",
            "https://longblack-contens.s3.ap-northeast-2.amazonaws.com/image/20260109/1767946388b29b85abaadfdd3c955d0c2620e4bf5c.png",
            "https://longblack-contens.s3.ap-northeast-2.amazonaws.com/image/20260107/17677774737a16067d49477e7b8b36bec3ab0a9d17.png",
            "https://longblack-contens.s3.ap-northeast-2.amazonaws.com/image/20260107/1767777461941d081fd270caedcf978cc497944277.png",
            "https://longblack-contens.s3.ap-northeast-2.amazonaws.com/image/20251231/176717253930de709dc8885df3385e0f903ac8a80d.png",
            "https://longblack-contens.s3.ap-northeast-2.amazonaws.com/image/20251231/176717253129756460f67875e063f5e4e8f3a6d9e1.png",
            "https://longblack-contens.s3.ap-northeast-2.amazonaws.com/image/20251224/1766565622366b4fa1860195c07097801614456294.png"
        ];
        const cats = ["브랜딩", "사업기획", "디자인", "자기계발", "테크", "책 리뷰", "예술"];
        let noteData = [];
        for(let i=0; i<60; i++) {
            noteData.push({
                cat: cats[i % cats.length],
                title: `LongBlack Archive Vol.${i+1}`,
                quote: "사소한 기록이 모여 당신만의 고유한 서사가 됩니다.",
                img: images[i % images.length]
            });
        }

        const container = document.getElementById('grid-container');
        const overlay = document.getElementById('focus-overlay');
        const navItems = document.querySelectorAll('.nav-item');
        let timelines = [], allTiles = [], isFiltered = false;

        function initGrid() {
            container.innerHTML = ''; timelines = []; allTiles = [];
            const rowCount = 5;
            const perRow = 12;

            for (let r = 0; r < rowCount; r++) {
                const row = document.createElement('div');
                row.className = 'grid-row';
                for (let i = 0; i < perRow; i++) {
                    const data = noteData[(r * perRow + i) % noteData.length];
                    const tile = document.createElement('div');
                    tile.className = 'tile';
                    tile.innerHTML = `<img src="${data.img}" loading="lazy">`;
                    tile.dataset.cat = data.cat;
                    tile.onclick = (e) => { e.stopPropagation(); if(isFiltered && !tile.classList.contains('matched')) return; showFocus(data); };
                    row.appendChild(tile);
                    allTiles.push(tile);
                }
                container.appendChild(row);
                // 기본 속도 상향 (duration을 줄임)
                const tl = gsap.to(row, { x: r % 2 === 0 ? "-30%" : "0%", duration: 40 + r*8, ease: "none", repeat: -1 });
                if(r % 2 !== 0) gsap.set(row, {x: "-30%"});
                timelines.push(tl);
            }
        }

        function organizeGrid(category) {
            isFiltered = category !== 'all';
            document.body.classList.toggle('is-filtered', isFiltered);
            if (!isFiltered) {
                timelines.forEach(tl => tl.play());
                allTiles.forEach(tile => {
                    tile.classList.remove('matched', 'dimmed');
                    gsap.to(tile, { x: 0, y: 0, scale: 1, opacity: 1, duration: 0.8, ease: "expo.out" });
                });
            } else {
                timelines.forEach(tl => tl.pause());
                const matched = allTiles.filter(t => t.dataset.cat === category);
                const unmatched = allTiles.filter(t => t.dataset.cat !== category);
                gsap.to(unmatched, { opacity: 0, scale: 0.3, duration: 0.4 });
                const winW = window.innerWidth;
                const cols = winW < 600 ? 2 : (winW < 1024 ? 3 : 4);
                const tileW = matched[0].offsetWidth;
                const tileH = matched[0].offsetHeight;
                const gap = parseInt(getComputedStyle(container).gap);
                const totalW = (cols * tileW) + ((cols - 1) * gap);
                const rows = Math.ceil(matched.length / cols);
                const totalH = (rows * tileH) + ((rows - 1) * gap);
                const startX = (winW - totalW) / 2;
                const startY = (window.innerHeight - totalH) / 2 + 30;

                matched.forEach((tile, idx) => {
                    tile.classList.add('matched');
                    tile.classList.remove('dimmed');
                    const rect = tile.getBoundingClientRect();
                    const targetX = startX + (idx % cols) * (tileW + gap) - rect.left;
                    const targetY = startY + Math.floor(idx / cols) * (tileH + gap) - rect.top;
                    gsap.to(tile, { x: targetX, y: targetY, scale: 1, opacity: 1, duration: 1.2, ease: "expo.out", delay: idx * 0.02 });
                });
            }
        }

        navItems.forEach(item => {
            item.onclick = () => {
                navItems.forEach(n => n.classList.remove('active'));
                item.classList.add('active');
                organizeGrid(item.dataset.cat);
            };
        });

        function showFocus(data) {
            document.getElementById('focus-img').src = data.img;
            document.getElementById('focus-quote').innerText = `“${data.quote}”`;
            document.getElementById('focus-title').innerText = data.title;
            overlay.classList.add('active');
        }
        overlay.onclick = () => overlay.classList.remove('active');

        // 모바일 터치 및 휠 반응형 가속 엔진 (Observer 최적화)
        gsap.registerPlugin(Observer);
        Observer.create({
            target: window,
            type: "wheel,touch,pointer", // 터치와 포인터 이벤트를 명시적으로 포함
            onChange: (self) => {
                if (isFiltered) return;
                
                // 모바일 터치 시 deltaY가 민감하게 반응하도록 가중치 조절
                const velocity = Math.abs(self.deltaY) * 0.08;
                
                timelines.forEach(tl => {
                    gsap.to(tl, { 
                        timeScale: 1 + velocity, 
                        duration: 0.2, 
                        overwrite: true, 
                        onComplete: () => gsap.to(tl, { timeScale: 1, duration: 2.0, ease: "power2.out" }) 
                    });
                });
            }
        });

        initGrid();
        window.onload = () => document.body.style.opacity = "1";
        window.onresize = () => { if(!isFiltered) initGrid(); else organizeGrid(document.querySelector('.nav-item.active').dataset.cat); };
    </script>
</body>
</html>
