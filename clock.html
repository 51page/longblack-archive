<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LongBlack - Massive Typography Art</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700;800&family=Montserrat:wght@900&family=Playfair+Display:ital,wght@1,900&family=Noto+Sans+KR:wght@100;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #000; --fg: #fff; --accent: #FF4E00; }
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: var(--bg); color: var(--fg); 
            overflow: hidden; transition: background 0.05s ease;
        }

        #art-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; }
        
        .text-fragment { 
            position: absolute; 
            white-space: nowrap; 
            will-change: transform, opacity; 
            line-height: 1;
            mix-blend-mode: difference; /* 흑백 반전 시에도 시각적 충격 유지 */
            user-select: none;
        }

        /* 중앙 시계 UI */
        #clock-container {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 280px; height: 280px; z-index: 5000; pointer-events: none;
        }
        .clock {
            width: 100%; height: 100%; border: 2px solid var(--fg);
            border-radius: 50%; position: relative; opacity: 0.3;
        }
        .hand { position: absolute; bottom: 50%; left: 50%; transform-origin: bottom; background: var(--fg); border-radius: 10px; }
        .sec { width: 2px; height: 110px; background: var(--accent); }
        .center-dot { position: absolute; top: 50%; left: 50%; width: 10px; height: 10px; background: var(--accent); border-radius: 50%; transform: translate(-50%, -50%); }

        #brand { position: fixed; top: 30px; left: 30px; font-family: 'Montserrat'; font-weight: 900; font-size: 1.5rem; z-index: 6000; letter-spacing: 5px; mix-blend-mode: difference; }
    </style>
</head>
<body>

    <div id="brand">LONGBLACK</div>
    <div id="art-canvas"></div>

    <div id="clock-container">
        <div class="clock">
            <div class="center-dot"></div>
            <div id="sec-hand" class="hand sec"></div>
        </div>
    </div>

    <script>
        let noteData = [];
        let isInverted = false;
        const canvas = document.getElementById('art-canvas');
        const fonts = ["'Nanum Myeongjo'", "'Montserrat'", "'Playfair Display'", "'Noto Sans KR'"];

        // 한글 해체 데이터
        const CHOSUNG = ['ㄱ','ㄲ','ㄴ','ㄷ','ㄸ','ㄹ','ㅁ','ㅂ','ㅃ','ㅅ','ㅆ','ㅇ','ㅈ','ㅉ','ㅊ','ㅋ','ㅌ','ㅍ','ㅎ'];
        const JUNGSUNG = ['ㅏ','ㅐ','ㅑ','ㅒ','ㅓ','ㅔ','ㅕ','ㅖ','ㅗ','ㅘ','ㅙ','ㅚ','ㅛ','ㅜ','ㅝ','ㅞ','ㅟ','ㅠ','ㅡ','ㅢ','ㅣ'];
        const JONGSUNG = ['','ㄱ','ㄲ','ㄳ','ㄴ','ㄵ','ㄶ','ㄷ','ㄹ','ㄺ','ㄻ','ㄼ','ㄽ','ㄾ','ㄿ','ㅀ','ㅁ','ㅂ','ㅄ','ㅅ','ㅆ','ㅇ','ㅈ','ㅊ','ㅋ','ㅌ','ㅍ','ㅎ'];

        function disassemble(str) {
            let result = [];
            for (let i = 0; i < str.length; i++) {
                const code = str.charCodeAt(i) - 44032;
                if (code > -1 && code < 11172) {
                    result.push(CHOSUNG[Math.floor(code / 588)]);
                    result.push(JUNGSUNG[Math.floor((code % 588) / 28)]);
                    const jong = JONGSUNG[code % 28];
                    if (jong) result.push(jong);
                } else { result.push(str[i]); }
            }
            return result;
        }

        Papa.parse("notedata.csv", {
            download: true, header: true,
            complete: function(results) {
                noteData = results.data.filter(row => row.note_title);
                startEngine();
            }
        });

        function startEngine() {
            setInterval(() => {
                // 1. 흑백 반전
                isInverted = !isInverted;
                document.body.style.setProperty('--bg', isInverted ? '#fff' : '#000');
                document.body.style.setProperty('--fg', isInverted ? '#000' : '#fff');

                // 2. 시계 업데이트
                gsap.to("#sec-hand", { rotation: new Date().getSeconds() * 6, duration: 0.3, ease: "elastic.out(1, 0.3)" });

                // 3. 타이포그래피 폭발
                renderTypographyArt();
            }, 1000);
        }

        function renderTypographyArt() {
            // 기존 텍스트 파괴 (사방으로 흩어짐)
            const old = document.querySelectorAll('.text-fragment');
            old.forEach(el => {
                gsap.to(el, {
                    x: (Math.random() - 0.5) * window.innerWidth * 2,
                    y: (Math.random() - 0.5) * window.innerHeight * 2,
                    rotation: Math.random() * 720,
                    opacity: 0,
                    duration: 0.8,
                    onComplete: () => el.remove()
                });
            });

            // 새로운 문장 선택
            const randomNote = noteData[Math.floor(Math.random() * noteData.length)];
            const fragments = disassemble(randomNote.note_title);

            fragments.forEach((char, i) => {
                if (char === " ") return;
                
                const span = document.createElement('div');
                span.className = 'text-fragment';
                span.innerText = char;

                // [강렬한 스타일 변주]
                const fontSize = Math.random() > 0.8 ? window.innerWidth * 0.4 : window.innerWidth * 0.15;
                span.style.fontSize = fontSize + "px";
                span.style.fontFamily = fonts[Math.floor(Math.random() * fonts.length)];
                span.style.fontWeight = Math.random() > 0.5 ? "900" : "100";
                span.style.opacity = 0;

                canvas.appendChild(span);

                // [랜덤 위치 배치]
                const targetX = Math.random() * window.innerWidth - (fontSize / 2);
                const targetY = Math.random() * window.innerHeight - (fontSize / 2);

                gsap.fromTo(span, {
                    x: window.innerWidth / 2,
                    y: window.innerHeight / 2,
                    rotation: Math.random() * 360,
                    scale: 0,
                    opacity: 0
                }, {
                    x: targetX,
                    y: targetY,
                    rotation: Math.random() * 40 - 20,
                    scale: 1,
                    opacity: Math.random() * 0.8 + 0.2,
                    duration: 0.6,
                    delay: i * 0.02, // 글자마다 미세한 시차
                    ease: "expo.out"
                });
            });
        }
    </script>
</body>
</html>
