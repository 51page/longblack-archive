<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LongBlack Kinetic Art - B&W</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@800&family=Montserrat:wght@900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #000; --fg: #fff; --accent: #FF4E00; }
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: var(--bg); color: var(--fg); 
            font-family: 'Montserrat', sans-serif; overflow: hidden;
            transition: background 0.1s ease-in-out; /* 배경 반전용 */
        }

        /* [배경 데이터 레이어] */
        #universe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
        
        .fragment { position: absolute; will-change: transform, opacity; }
        .img-fragment { border-radius: 2px; overflow: hidden; box-shadow: 0 0 30px rgba(0,0,0,0.5); }
        .img-fragment img { width: 100%; height: 100%; object-fit: cover; }
        
        .text-fragment { 
            font-family: 'Nanum Myeongjo'; font-weight: 800;
            white-space: nowrap; mix-blend-mode: difference; /* 대비 효과 극대화 */
        }

        /* [중앙 시계] */
        #clock-container {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 320px; height: 320px; z-index: 1000;
        }
        .clock {
            width: 100%; height: 100%; border: 4px solid var(--fg);
            border-radius: 50%; position: relative;
        }
        .hand { position: absolute; bottom: 50%; left: 50%; transform-origin: bottom; background: var(--fg); border-radius: 10px; }
        .hour { width: 8px; height: 80px; }
        .min { width: 5px; height: 110px; }
        .sec { width: 2px; height: 130px; background: var(--accent); }
        .center-dot { position: absolute; top: 50%; left: 50%; width: 14px; height: 14px; background: var(--accent); border-radius: 50%; transform: translate(-50%, -50%); }

        /* [UI] */
        #brand-logo { position: fixed; top: 50px; left: 50px; font-size: 2rem; letter-spacing: 8px; z-index: 2000; mix-blend-mode: difference; }
        #status { position: fixed; bottom: 50px; right: 50px; font-size: 0.8rem; letter-spacing: 2px; opacity: 0.8; mix-blend-mode: difference; }
    </style>
</head>
<body>

    <div id="brand-logo">LONGBLACK</div>
    <div id="status">PULSE: 1 SEC / CONTRAST: ON</div>

    <div id="universe"></div>

    <div id="clock-container">
        <div class="clock">
            <div class="center-dot"></div>
            <div id="hour-hand" class="hand hour"></div>
            <div id="min-hand" class="hand min"></div>
            <div id="sec-hand" class="hand sec"></div>
        </div>
    </div>

    <script>
        let noteData = [];
        const universe = document.getElementById('universe');
        let isInverted = false;

        // 한글 해체용 데이터
        const CHOSUNG = ['ㄱ','ㄲ','ㄴ','ㄷ','ㄸ','ㄹ','ㅁ','ㅂ','ㅃ','ㅅ','ㅆ','ㅇ','ㅈ','ㅉ','ㅊ','ㅋ','ㅌ','ㅍ','ㅎ'];
        const JUNGSUNG = ['ㅏ','ㅐ','ㅑ','ㅒ','ㅓ','ㅔ','ㅕ','ㅖ','ㅗ','ㅘ','ㅙ','ㅚ','ㅛ','ㅜ','ㅝ','ㅞ','ㅟ','ㅠ','ㅡ','ㅢ','ㅣ'];
        const JONGSUNG = ['','ㄱ','ㄲ','ㄳ','ㄴ','ㄵ','ㄶ','ㄷ','ㄹ','ㄺ','ㄻ','ㄼ','ㄽ','ㄾ','ㄿ','ㅀ','ㅁ','ㅂ','ㅄ','ㅅ','ㅆ','ㅇ','ㅈ','ㅊ','ㅋ','ㅌ','ㅍ','ㅎ'];

        function disassemble(str) {
            let result = [];
            for (let i = 0; i < str.length; i++) {
                const code = str.charCodeAt(i) - 44032;
                if (code > -1 && code < 11172) {
                    result.push(CHOSUNG[Math.floor(code / 588)]);
                    result.push(JUNGSUNG[Math.floor((code % 588) / 28)]);
                    const jong = JONGSUNG[code % 28];
                    if (jong) result.push(jong);
                } else { result.push(str[i]); }
            }
            return result;
        }

        Papa.parse("notedata.csv", {
            download: true, header: true,
            complete: function(results) {
                noteData = results.data.filter(row => row.note_title && row.thumbnail_url);
                startArtEngine();
            }
        });

        function startArtEngine() {
            setInterval(() => {
                // 1. 시각적 반전 (Black & White Toggle)
                isInverted = !isInverted;
                document.body.style.setProperty('--bg', isInverted ? '#fff' : '#000');
                document.body.style.setProperty('--fg', isInverted ? '#000' : '#fff');

                // 2. 시계 업데이트
                const now = new Date();
                gsap.to("#sec-hand", { rotation: now.getSeconds() * 6, duration: 0.3, ease: "elastic.out(1, 0.3)" });
                gsap.to("#min-hand", { rotation: now.getMinutes() * 6, duration: 0.5 });
                gsap.to("#hour-hand", { rotation: (now.getHours() % 12) * 30 + now.getMinutes() * 0.5, duration: 1 });

                // 3. 데이터 폭발 (드라마틱 변화)
                explodeData();
            }, 1000);
        }

        function explodeData() {
            // 기존 파편들 와장창 깨지며 사라지게 하기
            const oldFragments = document.querySelectorAll('.fragment');
            oldFragments.forEach(f => {
                gsap.to(f, { 
                    x: (Math.random() - 0.5) * 2000, 
                    y: (Math.random() - 0.5) * 2000, 
                    rotation: Math.random() * 720, 
                    opacity: 0, scale: 0, 
                    duration: 0.8, onComplete: () => f.remove() 
                });
            });

            // 새로운 데이터 파편 등장
            const data = noteData[Math.floor(Math.random() * noteData.length)];
            
            // 이미지 조각 생성 (1~3개 랜덤 크기)
            for(let i=0; i<Math.floor(Math.random()*3)+1; i++) {
                const imgWrap = document.createElement('div');
                imgWrap.className = 'fragment img-fragment';
                const size = 50 + Math.random() * 400; // 아주 작은 것부터 거대한 것까지
                imgWrap.style.width = size + 'px';
                imgWrap.style.height = (size * (0.5 + Math.random())) + 'px';
                imgWrap.innerHTML = `<img src="${data.thumbnail_url}">`;
                universe.appendChild(imgWrap);
                animateArt(imgWrap);
            }

            // 제목 자모 해체 등장
            const chars = disassemble(data.note_title);
            chars.forEach(char => {
                if(char === " ") return;
                const txt = document.createElement('div');
                txt.className = 'fragment text-fragment';
                txt.innerText = char;
                txt.style.fontSize = (20 + Math.random() * 100) + "px"; // 폰트 크기 대폭 변주
                universe.appendChild(txt);
                animateArt(txt);
            });
        }

        function animateArt(el) {
            const startX = window.innerWidth / 2;
            const startY = window.innerHeight / 2;
            const angle = Math.random() * Math.PI * 2;
            const dist = 100 + Math.random() * (window.innerWidth / 2);
            
            gsap.fromTo(el, {
                x: startX, y: startY, opacity: 0, scale: 0, rotation: 0
            }, {
                x: startX + Math.cos(angle) * dist - 50,
                y: startY + Math.sin(angle) * dist - 50,
                opacity: Math.random() + 0.2,
                scale: 1,
                rotation: Math.random() * 360,
                duration: 0.6,
                ease: "expo.out"
            });
        }
    </script>
</body>
</html>
