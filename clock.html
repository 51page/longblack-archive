<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LongBlack - Kinetic Audio V58</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="quote_data.js"></script> 
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@200;300;900&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #000; --fg: #fff; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: 'Montserrat', sans-serif; }
        #main-bg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 1; }
        
        /* 시계 영역 */
        #clock-wrapper { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10; pointer-events: none; }
        .digital-clock { color: #fff; font-size: clamp(3.5rem, 15vw, 8rem); font-weight: 200; letter-spacing: -0.04em; line-height: 1; }
        .sub-brand { margin-top: 15px; font-size: clamp(0.8rem, 2.5vw, 1.2rem); font-weight: 300; letter-spacing: 12px; text-transform: uppercase; }
        
        /* 문장 영역 */
        #quote-display { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; background: #000; visibility: hidden; padding: 0 10%; box-sizing: border-box; }
        .quote-text { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: clamp(1.4rem, 4vw, 2.2rem); font-weight: 500; color: #fff; text-align: center; line-height: 1.6; word-break: keep-all; letter-spacing: -0.02em; margin-bottom: 30px; }
        .quote-source { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: clamp(0.8rem, 1.5vw, 1rem); font-weight: 300; color: rgba(255,255,255,0.6); letter-spacing: 0.1em; text-transform: uppercase; text-align: center; }
        
        /* 사운드 컨트롤 아이콘 */
        #sound-control {
            position: fixed; bottom: 30px; right: 30px; z-index: 9999;
            width: 44px; height: 44px; background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease; mix-blend-mode: difference;
        }
        #sound-control:hover { background: rgba(255,255,255,0.3); transform: scale(1.1); }
        #sound-control svg { width: 20px; height: 20px; fill: #fff; }
    </style>
</head>
<body>

    <div id="sound-control" title="Toggle Sound">
        <svg id="icon-on" viewBox="0 0 24 24"><path d="M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.85 14,18.71V20.77C18.01,19.86 21,16.28 21,12C21,7.72 18.01,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16.02C15.5,15.29 16.5,13.77 16.5,12M3,9V15H7L12,20V4L7,9H3Z"/></svg>
        <svg id="icon-off" viewBox="0 0 24 24" style="display:none;"><path d="M12,4L9.91,6.09L12,8.18M4.27,3L3,4.27L7.73,9H3V15H7L12,20V13.27L16.25,17.53C15.58,18.04 14.83,18.46 14,18.7V20.77C15.38,20.45 16.63,19.82 17.68,18.96L19.73,21L21,19.73L12,10.73M19,12C19,12.94 18.8,13.82 18.46,14.64L19.97,16.15C20.62,14.91 21,13.5 21,12C21,7.72 18.01,4.14 14,3.23V5.29C16.89,6.15 19,8.83 19,12M16.5,12C16.5,11.53 16.42,11.08 16.28,10.66L14,8.38V15.54L15.36,14.18C16.08,13.63 16.5,12.87 16.5,12Z"/></svg>
    </div>

    <div id="main-bg"></div>

    <div id="clock-wrapper">
        <div id="clock" class="digital-clock">00:00:00</div>
        <div id="clock-sub" class="sub-brand">LongBlack</div>
    </div>

    <div id="quote-display">
        <div id="target-quote" class="quote-text">Loading...</div>
        <div id="target-source" class="quote-source">Source</div>
    </div>

    <script>
        const customColors = ['#000000', '#FF4B22', '#D6B38E', '#9FE99E', '#555FFF'];
        let lastDirection = "";
        let lastSecond = -1;
        let isQuotePhase = false;
        let cycleCounter = 0;
        let soundEnabled = false;

        // --- [오디오 시스템] ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playTick() {
            if (!soundEnabled || audioCtx.state === 'suspended') return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sine'; 
            osc.frequency.setValueAtTime(800, audioCtx.currentTime); 
            gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.05);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + 0.05);
        }

        const soundBtn = document.getElementById('sound-control');
        soundBtn.addEventListener('click', () => {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            soundEnabled = !soundEnabled;
            document.getElementById('icon-on').style.display = soundEnabled ? 'block' : 'none';
            document.getElementById('icon-off').style.display = soundEnabled ? 'none' : 'block';
        });

        // --- [모션 엔진] ---
        function getUniqueSlideParams() {
            const directions = ['left', 'right', 'top', 'bottom'];
            let currentDir;
            do { currentDir = directions[Math.floor(Math.random() * directions.length)]; } while (currentDir === lastDirection);
            lastDirection = currentDir;
            switch(currentDir) {
                case 'left': return { xPercent: -100, yPercent: 0 };
                case 'right': return { xPercent: 100, yPercent: 0 };
                case 'top': return { xPercent: 0, yPercent: -100 };
                case 'bottom': return { xPercent: 0, yPercent: 100 };
            }
        }

        function engine() {
            const now = new Date();
            const currentSec = now.getSeconds();

            if (currentSec !== lastSecond) { 
                lastSecond = currentSec;
                document.getElementById('clock').innerText = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(currentSec).padStart(2,'0')}`;
                
                playTick(); 

                if (!isQuotePhase) {
                    cycleCounter++;
                    if (cycleCounter >= 6) { 
                        triggerQuoteSequence();
                    } else {
                        triggerBackgroundSlide();
                    }
                }
            }
            requestAnimationFrame(engine);
        }

        function triggerBackgroundSlide() {
            const bg = document.getElementById('main-bg');
            const clock = document.getElementById('clock');
            const sub = document.getElementById('clock-sub');
            const nextColor = customColors[Math.floor(Math.random() * customColors.length)];
            const startPos = getUniqueSlideParams();

            gsap.fromTo(bg, 
                { ...startPos, backgroundColor: nextColor },
                { 
                    xPercent: 0, yPercent: 0, duration: 0.7, ease: "expo.out",
                    onStart: () => {
                        const targetColor = (nextColor === '#000000') ? '#ffffff' : '#000000';
                        clock.style.color = targetColor;
                        sub.style.color = targetColor;
                    }
                }
            );
        }

        function triggerQuoteSequence() {
            isQuotePhase = true;
            const dataTarget = (typeof quoteData !== 'undefined') ? quoteData : [];
            const selected = dataTarget[Math.floor(Math.random() * dataTarget.length)];
            
            document.getElementById('target-quote').innerText = selected?.text || "";
            document.getElementById('target-source').innerText = selected?.source || "";

            const startPos = getUniqueSlideParams();
            const exitPos = getUniqueSlideParams();

            const tl = gsap.timeline({
                onComplete: () => {
                    isQuotePhase = false;
                    cycleCounter = 0;
                    gsap.set("#quote-display", { visibility: "hidden" });
                    gsap.to("#clock-wrapper", { opacity: 1, duration: 0.3 });
                }
            });

            tl.set("#quote-display", { visibility: "visible", xPercent: startPos.xPercent, yPercent: startPos.yPercent, opacity: 1 })
              .to("#clock-wrapper", { opacity: 0, duration: 0.2 })
              .to("#quote-display", { xPercent: 0, yPercent: 0, duration: 0.7, ease: "expo.out" })
              .to({}, { duration: 4.0 }) 
              .to("#quote-display", { xPercent: exitPos.xPercent, yPercent: exitPos.yPercent, duration: 0.7, ease: "expo.in" });
        }

        window.onload = engine;
    </script>
</body>
</html>
